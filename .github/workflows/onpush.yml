name: Push tests

on: [ push, workflow_call ]

jobs:   

  compare_files:
    name: compare
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Check actions file 
        run: |
          cd ${GITHUB_WORKSPACE}
          mkdir actual && cd actual
          git init
          git remote add origin -f https://github.com/Andrianov-Artemii/ppt-solutions-2022
          echo "actions/" >> .git/info/sparse-checkout
          git pull master
          cd ../
          ls -la
          if ( diff -r --brief "./github/workflow/onpush.yml" "https://github.com/Andrianov-Artemii/ppt-check-ex/blob/dev2/test/onpush.yml" ); then
              echo 'status ok!'
          else
              echo 'status 500!'
          fi

  check_push_context:
    name: Check push conditions and run tests
    uses: Andrianov-Artemii/ppt-solutions-2022/.github/workflows/onpush-in-repo.yml@master